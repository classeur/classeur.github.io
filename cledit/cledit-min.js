!function(t){function e(n,o,i){function r(){var t=n.textContent.replace(/\r\n?/g,"\n");return"\n"!==t.slice(-1)&&(t+="\n"),t}function s(){return x}function a(t,e){$=N.parseSections(t,e),b.$allElements=Array.prototype.slice.call(n.querySelectorAll(".cledit-section *")),b.$trigger("contentChanged",t,$)}function c(t){O.saveSelectionState(!0,!0,t)}function d(t,e,n){var o=Math.min(t,e),i=Math.max(t,e),r=O.createRange(o,i),s=""+r;return s.length!==i-o||s!=n?(r.deleteContents(),r.insertNode(b.$document.createTextNode(n)),r):void 0}function l(t,e,n){var o=r();n=void 0!==n&&n<o.length?n:o.length-1;var i=Math.min(L.diff_commonPrefix(o,t),n),s=Math.min(L.diff_commonSuffix(o,t),o.length-i,t.length-i),a=t.substring(i,t.length-s),c=d(i,o.length-s,a);return c&&(D=e,R=!0),{start:i,end:t.length-s,range:c}}function f(t,e,n){U.setDefaultMode("single"),d(t,e,n);var o=t+n.length;O.setSelectionStartEnd(o,o),O.updateCursorCoordinates(!0)}function u(t,e){U.setDefaultMode("single");var n=r(),o=n.replace(t,e);if(o!=n){var i=b.setContent(o);O.setSelectionStartEnd(i.end,i.end),O.updateCursorCoordinates(!0)}}function h(t,e){var n=O.selectionStart;if(n!==O.selectionEnd)return!1;var o=O.createRange(n-t.length,n);return""+o!=t?!1:(o.deleteContents(),o.insertNode(b.$document.createTextNode(e)),n=n-t.length+e.length,O.setSelectionStartEnd(n,n),O.updateCursorCoordinates(!0),!0)}function g(){O.restoreSelection()}function p(t){b.$markers[t.id]=t}function v(t){delete b.$markers[t.id]}function m(t){R||T.noWatch(function(){function e(t){for(;t&&t!==n;){if(t.section)return void((t.parentNode?i:o)[t.section.id]=t.section);t=t.parentNode}}var o={},i={};t.forEach(function(t){e(t.target),Array.prototype.forEach.call(t.addedNodes,e),Array.prototype.forEach.call(t.removedNodes,e)}),o=Object.keys(o).map(function(t){return o[t]}),i=Object.keys(i).map(function(t){return i[t]}),N.fixContent(i,o)}),R=!1;var e=r();if(!e||e!=x){var o=L.diff_main(x,e);if(!D){var i=L.patch_make(x,o);U.addPatches(i),U.setDefaultMode("typing")}Object.keys(b.$markers).forEach(function(t){b.$markers[t].adjustOffset(o)}),x=e,O.saveSelectionState(),a(x),D||U.saveState(),D=!1,H()}}function C(t,e){e=void 0===e?t:e,O.setSelectionStartEnd(t,e),O.updateCursorCoordinates()}function S(t){return function(e){17!==e.which&&91!==e.which&&18!==e.which&&16!==e.which&&t(e)}}function E(){b.$window.removeEventListener("keydown",w),b.$window.removeEventListener("mouseup",y)}function w(t){return b.$window.document.contains(n)?void S(function(){c()})(t):E()}function y(){return b.$window.document.contains(n)?void O.saveSelectionState(!0,!1):E()}function M(t,e){var n=b.$keystrokes[t]||[];n.push(e),b.$keystrokes[t]=n}o=o||n;var b={$contentElt:n,$scrollElt:o,$window:i||window,$keystrokes:[],$markers:{}};b.$document=b.$window.document,e.Utils.createEventHooks(b);var k=e.Utils.debounce;b.toggleEditable=function(t){void 0===t&&(t=!n.contentEditable),n.contentEditable=t},b.toggleEditable(!0);var $,x=r(),N=new e.Highlighter(b),T=new e.Watcher(b,m);T.startWatching();var L=new t,O=new e.SelectionMgr(b),D=!1,R=!1,U=new e.UndoMgr(b),H=k(function(){var t=b.$window.getSelection();O.hasFocus&&!N.isComposing&&O.selectionStart===O.selectionEnd&&t.modify&&(O.selectionStart?(t.modify("move","backward","character"),t.modify("move","forward","character")):(t.modify("move","forward","character"),t.modify("move","backward","character")))},10);return b.$window.addEventListener("keydown",w,!1),b.$window.addEventListener("mouseup",y),n.addEventListener("contextmenu",O.saveSelectionState.bind(O,!0,!1)),n.addEventListener("keydown",S(function(t){O.saveSelectionState(),c(),b.$keystrokes.some(function(e){return e.some(function(e){return e.perform(t,b)})})}),!1),n.addEventListener("compositionstart",function(){N.isComposing++},!1),n.addEventListener("compositionend",function(){setTimeout(function(){N.isComposing--},0)},!1),n.addEventListener("paste",function(t){U.setCurrentMode("single"),t.preventDefault();var e,n=t.clipboardData;n?e=n.getData("text/plain"):(n=b.$window.clipboardData,e=n&&n.getData("Text")),e&&(f(O.selectionStart,O.selectionEnd,e),c())},!1),n.addEventListener("cut",function(){U.setCurrentMode("single"),c()},!1),n.addEventListener("focus",function(){O.hasFocus=!0,b.$trigger("focus")},!1),n.addEventListener("blur",function(){O.hasFocus=!1,b.$trigger("blur")},!1),e.defaultKeystrokes.forEach(function(t){M(100,t)}),b.selectionMgr=O,b.undoMgr=U,b.highlighter=N,b.watcher=T,b.adjustCursorPosition=c,b.setContent=l,b.replace=f,b.replaceAll=u,b.replacePreviousText=h,b.getContent=r,b.getLastContent=s,b.focus=g,b.setSelection=C,b.addKeystroke=M,b.addMarker=p,b.removeMarker=v,b.init=function(t){t=e.Utils.extend({cursorFocusRatio:.5,highlighter:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},sectionDelimiter:""},t||{}),b.options=t,void 0!==t.content&&(x=t.content.toString(),"\n"!==x.slice(-1)&&(x+="\n")),a(x,!0),void 0!==t.selectionStart&&void 0!==t.selectionEnd?b.setSelection(t.selectionStart,t.selectionEnd):O.saveSelectionState(),U.init(),void 0!==t.scrollTop&&(o.scrollTop=t.scrollTop)},b}window.cledit=e}(window.diff_match_patch),function(t){function e(t){var e=t.createElement("style");e.type="text/css",e.innerHTML=".cledit-section * { display: inline; }",t.head.appendChild(e),o.push(e)}function n(n){function r(t){this.id=++i,this.text=t}function s(t){var e=n.options.highlighter(t.text).replace(/\n/g,g),o=n.$document.createElement("div");o.id="cledit-section-"+t.id,o.className="cledit-section",o.innerHTML=e,t.setElement(o),a.$trigger("sectionHighlighted",t)}var a=this;t.Utils.createEventHooks(this),o.some(function(t){return n.$document.head.contains(t)})||e(n.$document);var c=n.$contentElt;this.isComposing=0;var d,l=[],f=t.Utils.isWebkit,u="div",h='<br><span class="hd-lf" style="display: none">\n</span>',g='<span class="lf">'+(f?h:"\n")+"</span>";this.fixContent=function(t){t.forEach(function(t){t.forceHighlighting=!0,t.hiddenLfEltList&&Array.prototype.slice.call(t.hiddenLfEltList).forEach(function(t){t.parentNode.removeChild(t)}),t.brEltList&&Array.prototype.slice.call(t.brEltList).forEach(function(t){t.parentNode.replaceChild(n.$document.createTextNode("\n"),t)}),"\n"!==t.elt.textContent.slice(-1)&&t.elt.appendChild(n.$document.createTextNode("\n"))})},this.addTrailingNode=function(){this.trailingNode=n.$document.createElement(u),c.appendChild(this.trailingNode)},r.prototype.setElement=function(t){this.elt=t,t.section=this,f&&(this.hiddenLfEltList=t.getElementsByClassName("hd-lf"),this.brEltList=t.getElementsByTagName("br"))},this.parseSections=function(t,e){if(this.isComposing)return l;var o=n.options.sectionParser?n.options.sectionParser(t):[t];o=o.map(function(t){return new r(t)});var i=[],a=[];if(d=void 0,e)a=l,l=o,i=o;else{var f=l.length;l.some(function(t,e){var n=o[e];return e>=o.length||t.forceHighlighting||t.text!=n.text||t.elt.parentNode!==c||t.elt.textContent!=n.text?(f=e,!0):void 0});var u=-l.length;l.slice().reverse().some(function(t,e){var n=o[o.length-e-1];return e>=o.length||t.forceHighlighting||t.text!=n.text||t.elt.parentNode!==c||t.elt.textContent!=n.text?(u=-e,!0):void 0}),f-u>l.length&&(u=f-l.length);var h=l.slice(0,f);i=o.slice(f,o.length+u);var g=l.slice(l.length+u,l.length);d=g[0],a=l.slice(f,l.length+u),l=h.concat(i).concat(g)}var p=n.$document.createDocumentFragment();return i.forEach(function(t){t.forceHighlighting=!1,s(t),p.appendChild(t.elt)}),n.watcher.noWatch(function(){if(e)return c.innerHTML="",c.appendChild(p),this.addTrailingNode();a.forEach(function(t){t.elt.parentNode===c&&c.removeChild(t.elt),t.elt.section=void 0}),void 0!==d?c.insertBefore(p,d.elt):c.appendChild(p);for(var t=c.firstChild;t;){var o=t.nextSibling;t.section||c.removeChild(t),t=o}this.addTrailingNode(),n.selectionMgr.restoreSelection(),n.selectionMgr.updateCursorCoordinates()}.bind(this)),l}}var o=[],i=0;t.Highlighter=n}(window.cledit),function(t){function e(t){this.handler=t}e.prototype.perform=function(t,e){var n=e.getContent(),o=Math.min(e.selectionMgr.selectionStart,e.selectionMgr.selectionEnd),i=Math.max(e.selectionMgr.selectionStart,e.selectionMgr.selectionEnd),r=e.selectionMgr.selectionStart>e.selectionMgr.selectionEnd,s={before:n.slice(0,o),after:n.slice(i),selection:n.slice(o,i)};return this.handler(t,s,e)?(e.setContent(s.before+s.selection+s.after,!1,o),o=s.before.length,i=o+s.selection.length,e.selectionMgr.setSelectionStartEnd(r?i:o,r?o:i),!0):void 0},t.Keystroke=e;var n;t.defaultKeystrokes=[new e(function(t,e,n){if((t.ctrlKey||t.metaKey)&&!t.altKey){var o,i=t.charCode||t.keyCode,r=String.fromCharCode(i).toLowerCase();switch(r){case"y":o="redo";break;case"z":o=t.shiftKey?"redo":"undo"}return o?(t.preventDefault(),setTimeout(function(){n.undoMgr[o]()},10),!0):void 0}}),new e(function(t,e){function n(t,e,n,o){return n=+n||0,o=o||"",t.slice(0,e)+o+t.slice(e+n)}if(9===t.which&&!t.metaKey&&!t.ctrlKey){t.preventDefault();var o=t.shiftKey,i=e.before.lastIndexOf("\n")+1;return o?(/\s/.test(e.before.charAt(i))&&(e.before=n(e.before,i,1)),e.selection=e.selection.replace(/^[ \t]/gm,"")):e.selection?(e.before=n(e.before,i,0,"	"),e.selection=e.selection.replace(/\n(?=[\s\S])/g,"\n	")):e.before+="	",!0}}),new e(function(t,e,o){if(13!==t.which)return void(n=!1);t.preventDefault();var i=e.before.lastIndexOf("\n")+1;if(n)return e.before=e.before.substring(0,i),e.selection="",n=!1,!0;n=!1;var r=e.before.slice(i),s=r.match(/^\s*/)[0];return s.length&&(n=!0),o.undoMgr.setCurrentMode("single"),e.before+="\n"+s,e.selection="",!0}),new e(function(t,e,n){return 8===t.which||46===t.which?(t.preventDefault(),n.undoMgr.setCurrentMode("delete"),e.selection||(8===t.which?e.before=e.before.slice(0,-1):e.after=e.after.slice(1)),e.selection="",!0):void 0})]}(window.cledit),function(t){function e(t){this.id=Math.random().toString(36).slice(2),this.offset=t}var n=-1,o=1,i=0;e.prototype.adjustOffset=function(t){var e=0;t.forEach(function(t){var r=t[0],s=t[1],a=s.length;switch(r){case i:e+=a;break;case o:this.offset>e&&(this.offset+=a),e+=a;break;case n:this.offset>e&&(this.offset-=a)}}.bind(this))},t.Marker=e}(window.cledit),function(t){function e(e){function n(t){return u&&u.startContainer===t.startContainer&&u.startOffset===t.startOffset&&u.endContainer===t.endContainer&&u.endOffset===t.endOffset?void 0:(u=t,a.$trigger("selectionChanged",a.selectionStart,a.selectionEnd,t),!0)}function o(t,e){void 0===t&&(t=a.selectionStart),0>t&&(t=0),void 0===e&&(e=this.selectionEnd),0>e&&(e=0),a.selectionStart=t,a.selectionEnd=e,h()}var i=t.Utils.debounce,r=e.$contentElt,s=e.$scrollElt;t.Utils.createEventHooks(this);var a=this,c=0,d=0;this.selectionStart=0,this.selectionEnd=0,this.cursorCoordinates={},this.adjustTop=0,this.adjustBottom=0,this.findContainer=function(t){function e(t,e){if("\n"===t.nodeValue){var n=t.parentNode;"hd-lf"===n.className&&n.previousSibling&&"BR"===n.previousSibling.tagName&&(t=n.parentNode,e=Array.prototype.indexOf.call(t.childNodes,0===e?n.previousSibling:n))}return{container:t,offsetInContainer:e}}var n,o=0,i=r;do if(n=i,i=i.firstChild)do{var s=i.textContent.length;if(t>=o&&o+s>t)break;o+=s}while(i=i.nextSibling);while(i&&i.firstChild&&3!==i.nodeType);if(i)return e(i,t-o);for(;n.lastChild;)n=n.lastChild;return e(n,3===n.nodeType?n.textContent.length:0)},this.createRange=function(t,n){var o=e.$document.createRange();return t===n?n=t=isNaN(t)?t:this.findContainer(0>t?0:t):(t=isNaN(t)?t:this.findContainer(0>t?0:t),n=isNaN(n)?n:this.findContainer(0>n?0:n)),o.setStart(t.container,t.offsetInContainer),o.setEnd(n.container,n.offsetInContainer),o};var l,f=i(function(){var t=this.getCoordinates(this.selectionEnd,this.selectionEndContainer,this.selectionEndOffset);if((this.cursorCoordinates.top!==t.top||this.cursorCoordinates.height!==t.height||this.cursorCoordinates.left!==t.left)&&(this.cursorCoordinates=t,this.$trigger("cursorCoordinatesChanged",t)),l){var n,o;if(n=o=s.clientHeight/2*e.options.cursorFocusRatio,n=this.adjustTop||n,o=this.adjustBottom||n,n&&o){var i=s.scrollTop+n,r=s.scrollTop+s.clientHeight-o;this.cursorCoordinates.top<i?s.scrollTop+=this.cursorCoordinates.top-i:this.cursorCoordinates.top+this.cursorCoordinates.height>r&&(s.scrollTop+=this.cursorCoordinates.top+this.cursorCoordinates.height-r)}}l=!1}.bind(this));this.updateCursorCoordinates=function(t){l=l||t,f()};var u;this.restoreSelection=function(){var t=Math.min(this.selectionStart,this.selectionEnd),o=Math.max(this.selectionStart,this.selectionEnd),i=this.createRange(t,o),r=e.$window.getSelection();r.removeAllRanges();var s=this.selectionStart>this.selectionEnd;if(s&&r.extend){var a=i.cloneRange();a.collapse(!1),r.addRange(a),r.extend(i.startContainer,i.startOffset)}else r.addRange(i);return n(i),i};var h=i(function(){c=a.selectionStart,d=a.selectionEnd},50);this.setSelectionStartEnd=function(t,e){return o(t,e),this.restoreSelection()},this.saveSelectionState=function(){function t(t,e){for(var n=t.length;n--;)if(t[n]===e)return!0;return!1}function s(t,e,n){for(var o,i=n?t:t.parentNode;i;){if(o=i.parentNode,o===e)return i;i=o}return null}function l(t){for(var e=0;t=t.previousSibling;)++e;return e}function f(e,n){var o,i=[];for(o=e;o;o=o.parentNode)i.push(o);for(o=n;o;o=o.parentNode)if(t(i,o))return o;return null}function u(t,e,n,o){var i,r,a,c,d;if(t==n)return e===o?0:o>e?-1:1;if(i=s(n,t,!0))return e<=l(i)?-1:1;if(i=s(t,n,!0))return l(i)<o?-1:1;if(r=f(t,n),!r)throw new Error("comparePoints error: nodes have no common ancestor");if(a=t===r?r:s(t,r,!0),c=n===r?r:s(n,r,!0),a===c)throw module.createError("comparePoints got to case 4 and childA and childB are the same!");for(d=r.firstChild;d;){if(d===a)return-1;if(d===c)return 1;d=d.nextSibling}}function h(){var t,i=a.selectionStart,s=a.selectionEnd,d=e.$window.getSelection();if(d.rangeCount>0){var l=d.getRangeAt(0),f=l.startContainer;if(r.compareDocumentPosition(f)&Node.DOCUMENT_POSITION_CONTAINED_BY||r===f){var h=l.startOffset;f.firstChild&&h>0&&(f=f.childNodes[h-1],h=f.textContent.length);for(var g=f;f!=r;){for(;f=f.previousSibling;)h+=(f.textContent||"").length;f=g=g.parentNode}var p=l+"",v=l.endContainer.firstChild;v&&"BR"===v.tagName&&1===l.endOffset&&(p+="\n"),1==u(d.anchorNode,d.anchorOffset,d.focusNode,d.focusOffset)?(i=h+p.length,s=h):(i=h,s=h+p.length),i===s&&i===e.getContent().length?(i=--s,t=a.setSelectionStartEnd(i,s)):(o(i,s),t=n(l),t=t||c!==a.selectionStart)}}return t}function g(){return h()&&(c!==a.selectionStart||d!==a.selectionEnd)}var p=!1,v=i(function(){a.updateCursorCoordinates(g()&&p),m()}),m=i(function(){a.updateCursorCoordinates(g()&&p),p=!1},10);return function(t,e,n){return n&&(c=void 0,d=void 0),t?(p=p||e,v()):void h()}}(),this.getSelectedText=function(){var t=Math.min(this.selectionStart,this.selectionEnd),n=Math.max(this.selectionStart,this.selectionEnd);return e.getLastContent().substring(t,n)},this.getCoordinates=function(t,n,o){if(!n){var i=this.findContainer(t);n=i.container,o=i.offsetInContainer}var s=n;s.hasChildNodes()||(s=n.parentNode);for(var a=!1,c=e.$allElements.indexOf(s);0===s.offsetHeight&&c>0;)a=!0,s=e.$allElements[--c];if(a||"\n"==n.textContent)return{top:s.offsetTop,height:s.offsetHeight,left:s.offsetLeft};var d=e.getContent()[t],l={container:n,offsetInContainer:o},f={container:n,offsetInContainer:o},u="left";t>0&&(void 0===d||"\n"==d)?(u="right",0===l.offsetInContainer?l=t-1:l.offsetInContainer-=1):f.offset===n.textContent.length?f=t+1:f.offsetInContainer+=1;var h=this.createRange(l,f),g=h.getBoundingClientRect();return{top:Math.round(g.top-r.getBoundingClientRect().top+r.scrollTop),height:Math.round(g.height),left:Math.round(g[u]-r.getBoundingClientRect().left+r.scrollLeft)}},this.getClosestWordOffset=function(t){var n=0,o=0,i=0;return e.getContent().split(/\s/).some(function(e){return e&&(n=i,o=i+e.length,o>t)?!0:void(i+=e.length+1)}),{start:n,end:o}}}t.SelectionMgr=e}(window.cledit),function(t,e){function n(n,o){function i(){}function r(t){return function(){t.push(this),this.patches=g,g=[]}}function s(){var t,e,n;this.isBufferState=function(){return t=Date.now(),"single"!=this.currentMode&&this.currentMode==n&&t-e<o.bufferStateUntilIdle},this.setDefaultMode=function(t){this.currentMode=this.currentMode||t},this.resetMode=function(){m.currentMode=void 0,n=void 0},this.saveMode=function(){n=this.currentMode,this.currentMode=void 0,e=t}}function a(){Array.prototype.push.apply(g,p),p=[]}function c(t,e){var o=n.getContent();e||(t=C.patch_deepCopy(t).reverse(),t.forEach(function(t){t.diffs.forEach(function(t){t[0]=-t[0]})}));var i=C.patch_apply(t,o)[0],r=n.setContent(i,!0),s=C.diff_main(o,i);Object.keys(n.$markers).forEach(function(t){n.$markers[t].adjustOffset(s)}),d.setSelectionStartEnd(r.end,r.end),d.updateCursorCoordinates(!0),m.resetMode(),f.$trigger("undoStateChange"),n.adjustCursorPosition()}t.Utils.createEventHooks(this),o=t.Utils.extend({undoStackMaxSize:200,bufferStateUntilIdle:1e3},o||{});var d,l,f=this,u=[],h=[],g=[],p=[],v=t.Utils.debounce;i.prototype.addToUndoStack=r(u),i.prototype.addToRedoStack=r(h);var m=new s;this.setCurrentMode=function(t){m.currentMode=t},this.setDefaultMode=m.setDefaultMode.bind(m);var C=new e;this.addPatches=function(t){p.push.apply(p,t)},this.saveState=v(function(){if(h.length=0,!m.isBufferState())for(l.addToUndoStack();u.length>o.undoStackMaxSize;)u.shift();a(),l=new i,m.saveMode(),f.$trigger("undoStateChange")}),this.canUndo=function(){return!!u.length},this.canRedo=function(){return!!h.length},this.undo=function(){var t=u.pop();t&&(a(),l.addToRedoStack(),c(l.patches),g=t.patches,l=t)},this.redo=function(){var t=h.pop();t&&(l.addToUndoStack(),c(t.patches,!0),g=t.patches,l=t)},this.init=function(){d=n.selectionMgr,l||(l=new i)}}t.UndoMgr=n}(window.cledit,window.diff_match_patch),function(t){var e={isGecko:"MozAppearance"in document.documentElement.style,isWebkit:"WebkitAppearance"in document.documentElement.style,isMsie:"msTransform"in document.documentElement.style};e.defer=function(){var t=[],e="deferMsg";return window.addEventListener("message",function(n){n.source==window&&n.data==e&&(n.stopPropagation(),t.length>0&&t.shift()())},!0),function(n){t.push(n),window.postMessage(e,"*")}}(),e.debounce=function(t,n){var o,i=!1;return n?function(){clearTimeout(o),o=setTimeout(t,n)}:function(){i!==!0&&(i=!0,e.defer(function(){i=!1,t()}))}},e.createEventHooks=function(t){var e={};t.$trigger=function(n){var o=e[n];if(o){var i=Array.prototype.slice.call(arguments,1);o.forEach(function(e){try{e.apply(t,i)}catch(n){}})}},t.on=function(t,n){var o=e[t];o||(o=[],e[t]=o),o.push(n)},t.off=function(t,n){var o=e[t];if(o){var i=o.indexOf(n);i>-1&&o.splice(i,1)}}},e.extend=function(t,e){return Object.keys(e).map(function(n){t[n]=e[n]}),t},t.Utils=e}(window.cledit),function(t){function e(t,e){this.isWatching=!1;var n;this.startWatching=function(){this.isWatching=!0,n=n||new MutationObserver(e),n.observe(t.$contentElt,{childList:!0,subtree:!0,characterData:!0})},this.stopWatching=function(){n.disconnect(),this.isWatching=!1},this.noWatch=function(t){return this.isWatching===!0?(this.stopWatching(),t(),this.startWatching()):void t()}}t.Watcher=e}(window.cledit);